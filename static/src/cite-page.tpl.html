<div class="page cite-page">

    <div class="content">
        <div class="main">
            <div class="loading"
                 ng-show="apiResp=='loading'">
                <span class="label">Building your citation&hellip;</span>
                <md-progress-linear md-mode="indeterminate"></md-progress-linear>
            </div>

            <div class="error" ng-show="apiResp=='error'">
                <h2>Sorry!</h2>
                <div class="text">
                    We weren't able to figure out a citation for this research product.
                    We're in active development and hopefully this particular case will
                    be working soon. Feel free to
                    <a href="mailto:team@impactstory.org">let us know</a> and we'll
                    look into it.
                </div>
            </div>

            <div class="citation animated fadeIn" ng-show="apiResp.citations">
                <div class="heading">
                    <h1>
                        {{ apiResp.name }}
                    </h1>
                    <div class="metadata">
                        <a href="{{ apiResp.url }}"><i class="fa fa-external-link"></i> view website</a>
                    </div>
                </div>


                <div class="citation-options">
                    <h2 class="label">Cite this project as:</h2>
                    <md-input-container>
                        <md-select ng-model="user.selectedCitation">
                            <md-option ng-repeat="myCitationObj in apiResp.citations"
                                       ng-value="myCitationObj">
                            {{ myCitationObj.style_fullname }}
                            </md-option>
                        </md-select>
                    </md-input-container>

                </div>

                <div id="citation" class="text" ng-bind-html="user.selectedCitation.citation">
                </div>

                <div class="under-citation">
                    <div class="export-options">

                        <md-button ng-click="copy()" class="md-raised">
                            <i class="fa fa-clipboard"></i>
                            Copy
                        </md-button>


                        <md-menu>
                            <md-button ng-click="openMenu($mdOpenMenu, $event)">
                                <i class="fa fa-download"></i>
                                Download
                            </md-button>

                            <md-menu-content width="4">
                                <md-menu-item>
                                    <md-button ng-click="saveAs('endnote')">
                                        Endnote
                                    </md-button>
                                </md-menu-item>

                                <md-menu-item>
                                    <md-button ng-click="saveAs('refworks')">
                                        Refworks
                                    </md-button>
                                </md-menu-item>

                                <md-menu-item>
                                    <md-button ng-click="saveAs('bibtex')">
                                        BibTeX
                                    </md-button>
                                </md-menu-item>

                            </md-menu-content>
                        </md-menu>

                    </div>



                    <div class="more-actions">
                        <a class="action" href="http://api.citeas.org/product/{{ apiResp.url }}">
                            <i class="fa fa-cog"></i> view in API
                        </a>
                        <span class="action provenance">
                            <i class="fa fa-map"></i>
                            Provenance
                        </span>
                    </div>
                </div>


                <div class="provenance">
                    <!--
                    <h2>Citation provenance</h2>
                    -->
                    <div class="subheader">Here's trail we followed to find this citation:</div>
                    <div class="steps">
                        <div class="step" ng-repeat="step in apiResp.provenance" ng-if="apiResp.provenance.length > 1">


                            <span class="first-step" ng-if="$first">
                                We started with the
                            </span>

                            <!-- middle of 3 or more -->
                            <span class="middle-step" ng-if="!$first && !$last && apiResp.provenance.length > 2">
                                From there we followed a link to this
                            </span>

                            <!-- last of two -->
                            <span class="last-step" ng-if="$last" ng-if="$last && apiResp.provenance.length == 2">
                                We followed a link from there, finding the best citation metadata in the
                            </span>
                            
                            <!-- last of several -->
                            <span class="last-step" ng-if="$last && apiResp.provenance.length > 2">
                                Finally, we found the best citation metadata in the
                            </span>
                            
                            <!-- the actual link -->
                            <a href="{{ step.location }}">{{ step.context }}</a>

                        </div>
                    </div>


                </div>





            </div>

        </div>


    </div>

</div>